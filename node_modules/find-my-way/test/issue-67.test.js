'use strict'

const t = require('tap')
const test = t.test
const FindMyWay = require('../')
const noop = () => {}

test('static routes', t => {
  t.plan(1)
  const findMyWay = FindMyWay()

  findMyWay.on('GET', '/b/', noop)
  findMyWay.on('GET', '/b/bulk', noop)
  findMyWay.on('GET', '/b/ulk', noop)

  t.equal(findMyWay.find('GET', '/bulk'), null)
})

test('parametric routes', t => {
  t.plan(5)
  const findMyWay = FindMyWay()

  function bar () { }

  findMyWay.on('GET', '/bar/:barParam', bar)
  findMyWay.on('GET', '/bar/bar/:barParam', noop)
  findMyWay.on('GET', '/bar/search', noop)
  findMyWay.on('GET', '/bar/submit', noop)

  t.equal(findMyWay.find('GET', '/bar/awesome-parameter').handler, bar)
  t.equal(findMyWay.find('GET', '/bar/b-first-character').handler, bar)
  t.equal(findMyWay.find('GET', '/bar/s-first-character').handler, bar)
  t.equal(findMyWay.find('GET', '/bar/se-prefix').handler, bar)
  t.equal(findMyWay.find('GET', '/bar/sx-prefix').handler, bar)
})

test('parametric with common prefix', t => {
  t.plan(1)
  const findMyWay = FindMyWay()

  findMyWay.on('GET', '/test', noop)
  findMyWay.on('GET', '/:test', (req, res, params) => {
    t.same(
      { test: 'text' },
      params
    )
  })
  findMyWay.on('GET', '/text/hello', noop)

  findMyWay.lookup({ url: '/text', method: 'GET', headers: {} })
})
