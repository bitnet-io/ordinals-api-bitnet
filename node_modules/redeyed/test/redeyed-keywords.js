'use strict'

var test = require('tape')
var util = require('util')
var redeyed = require('..')

function inspect(obj) {
  return util.inspect(obj, false, 5, true)
}

test('adding custom asserts ... ', function(t) {
  t.constructor.prototype.assertSurrounds = function(code, opts, expected) {
    var optsi = inspect(opts)
    var result = redeyed(code, opts).code

    this.equals(result
                , expected
                , util.format('%s: %s => %s', optsi, inspect(code), inspect(expected))
               )
    return this
  }

  t.end()
})

test('types', function(t) {
  t.test('\n# Keyword', function(t) {
    var keyconfig = { 'Keyword': { _default: '$:%' } }
    t.assertSurrounds('import bar from \'bar\';', keyconfig, '$import% bar from \'bar\';')
    t.assertSurrounds('export default bar;', keyconfig, '$export% $default% bar;')
    t.assertSurrounds('if(bar) { let bar = 1;}', keyconfig, '$if%(bar) { $let% bar = 1;}')
    t.assertSurrounds('const x = "bar";', keyconfig, '$const% x = "bar";')
    t.assertSurrounds('"use strict";(function* () { yield *v })', keyconfig, '"use strict";($function%* () { $yield% *v })')
    t.assertSurrounds('"use strict"; (class A { static constructor() { super() }})', keyconfig
                      , '"use strict"; ($class% A { $static% constructor() { $super%() }})')
    t.assertSurrounds('class Foo { constructor(name){this.name = name;}}', keyconfig
                      , '$class% Foo { constructor(name){$this%.name = name;}}')
    t.assertSurrounds('class Foo extends Bar { constructor(name,value){super(value);this.name = name;}}', keyconfig
                      , '$class% Foo $extends% Bar { constructor(name,value){$super%(value);$this%.name = name;}}')
    t.end()
  })

  t.end()
})
